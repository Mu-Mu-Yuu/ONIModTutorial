---
sidebar: false
---
<a href="javascript:history.back()" class="back-button">
  â¬… è¿”å›
</a>

<style scoped>
.back-button {
  position: fixed;
  left: 20px;
  top: 100px;
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 15px;
  background-color: var(--vp-c-brand); 
  color: white !important;
  border-radius: 20px;
  text-decoration: none !important;
  font-weight: bold;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transition: transform 0.2s;
  z-index: 100;
  cursor: pointer;
}

.back-button:hover {
  transform: scale(1.05);
  opacity: 0.9;
}
</style>


# ğŸ§© Harmony è¡¥ä¸æ•´ç†

> **æœ¬ç¯‡æ˜¯ Harmony åœ¨ã€Šç¼ºæ°§ï¼ˆONIï¼‰ã€‹Mod å¼€å‘ä¸­çš„å®æˆ˜é€ŸæŸ¥è¡¨**  
> ğŸ‘‰ ç›®æ ‡ï¼š**å¿«é€Ÿäº†è§£ä»¥åŠä»€ä¹ˆæ—¶å€™è¯¥ç”¨å“ªä¸€ç§ Patch**

---

## ğŸ“– é˜…è¯»æŒ‡å¼•

- **åŸºç¡€æ“ä½œ**ï¼šäº†è§£ `Harmony` åˆå§‹åŒ–åŠ `Prefix / Postfix` çš„åŸºæœ¬ç”¨æ³•ã€‚
- **å¸¸ç”¨å‚æ•°**ï¼šäº†è§£ `__instance / __state / AccessTools` è¯»å†™æ¸¸æˆæ•°æ®ã€‚
- **ç‰¹æ®Šåœºæ™¯**ï¼šäº†è§£ `Transpiler / Finalizer` å¤„ç†åº•å±‚é€»è¾‘ä¸å¼‚å¸¸çš„æ–¹å¼ã€‚

---

## ğŸ§  ä¸€ã€Harmony æ˜¯ä»€ä¹ˆï¼Ÿ

Harmony æ˜¯ä¸€ä¸ª **è¿è¡Œæ—¶æ–¹æ³•æ³¨å…¥åº“**ï¼Œç”¨äºåœ¨**ä¸ä¿®æ”¹æºä»£ç **çš„æƒ…å†µä¸‹ï¼š

- æ’å…¥é€»è¾‘
- æ‹¦æˆªåŸæ–¹æ³•
- ä¿®æ”¹è¿”å›å€¼
- é‡å†™éƒ¨åˆ†æ‰§è¡Œæµç¨‹

---

## ğŸ§© äºŒã€Patch ç±»å‹æ€»è§ˆ

| Patch ç±»å‹ | æ‰§è¡Œæ—¶æœº | å¸¸è§ç”¨é€” |
|----------|----------|----------|
| Prefix | åŸæ–¹æ³•æ‰§è¡Œå‰ | æ‹¦æˆª / æ”¹å‚æ•° / é˜»æ­¢æ‰§è¡Œ |
| Postfix | åŸæ–¹æ³•æ‰§è¡Œå | è¡¥å……é€»è¾‘ / æ”¹è¿”å›å€¼ |
| Transpiler | IL å±‚ | æ”¹ç¡¬ç¼–ç  / if / å¸¸é‡ |
| Finalizer | æ‰€æœ‰é€»è¾‘å | æ•è·å¼‚å¸¸ / å…œåº• |
---

## âš™ï¸ ä¸‰ã€Harmony åˆå§‹åŒ–

> åœ¨ ONI ä¸­ï¼Œç»§æ‰¿ UserMod2 åï¼Œæ¸¸æˆä¼šè‡ªåŠ¨å¸®ä½ æ‰§è¡Œ harmony.PatchAll()ã€‚ä½ ä¸éœ€è¦å†æ‰‹åŠ¨è°ƒç”¨å®ƒï¼Œé™¤éä½ æœ‰ç‰¹æ®Šçš„åŠ¨æ€è¡¥ä¸éœ€æ±‚ã€‚


```csharp
using HarmonyLib;
using KMod;

namespace MyMod
{
    public class MyFirstMod : UserMod2
    {
        public override void OnLoad(Harmony harmony)
        {
            // 1. å¿…é¡»ä¿ç•™åŸºç±»è°ƒç”¨ï¼Œå®ƒä¼šå¤„ç†è‡ªåŠ¨ PatchAll
            base.OnLoad(harmony);

            // 2. è¿™é‡Œé€šå¸¸ç”¨æ¥æ”¾â€œå…¨å±€åˆå§‹åŒ–â€é€»è¾‘
            // æ¯”å¦‚ï¼šæ‰“å°æ—¥å¿—ç¡®è®¤ Mod å·²åŠ è½½
            Debug.Log("MyFirstMod å·²æˆåŠŸåŠ è½½ï¼");
        }
    }
}
```

---

## ğŸŸ¦ å››ã€Prefixï¼ˆæ‰§è¡Œå‰æ‹¦æˆªï¼‰

`Prefix` ç”¨äºåœ¨åŸä»£ç è·‘èµ·æ¥ä¹‹å‰å…ˆä¸€æ­¥æ‰§è¡Œã€‚

### 4.1 åŸºç¡€ç”¨æ³•ï¼šå•çº¯æ’å…¥é€»è¾‘
å¦‚æœä½ åªæƒ³åœ¨æŸä¸ªåŠ¨ä½œå‘ç”Ÿæ—¶é¡ºä¾¿åšç‚¹äº‹ï¼ˆæ¯”å¦‚è®°å½•æ—¥å¿—ï¼‰ï¼Œè¡¥ä¸è¿”å› void å³å¯ã€‚

```csharp
[HarmonyPatch(typeof(Operational), nameof(Operational.SetActive))]
public static class Log_Patch
{
    public static void Prefix(bool value)
    {
        // åªæ˜¯çœ‹ä¸€çœ¼å‚æ•°ï¼Œä¸å½±å“åŸé€»è¾‘æ‰§è¡Œ
        Debug.Log($"å»ºç­‘çŠ¶æ€å°è¯•åˆ‡æ¢ä¸º: {value}");
    }
}
```

---
### 4.2 è¿›é˜¶ç”¨æ³•ï¼šå¹²é¢„åŸé€»è¾‘

å¦‚æœä½ æƒ³æ”¹å˜æ¸¸æˆçš„ç»“æœï¼Œéœ€è¦æ³¨æ„ bool è¿”å›å€¼å’Œ ref å…³é”®å­—çš„ä½œç”¨ã€‚

| æ–¹å¼ | ä»£ç å…³é”®ç‚¹| å®é™…æ•ˆæœ |
|----------|----------|----------|
| å¼ºè¡Œç¯¡æ”¹ | `ref bool value` | æ”¹æŒ‡ä»¤ã€‚ åŸä»£ç ç…§æ ·è·‘ï¼Œä½†ä½ å·å·æ¢æ‰äº†å®ƒçš„å‚æ•°ï¼ˆæ¯”å¦‚è®©å…³æœºæŒ‡ä»¤å˜æˆå¼€æœºï¼‰ |
| å½»åº•æ‹¦æˆª | `return false` | æ–­åè·¯ã€‚ åŸä»£ç è¢«ç›´æ¥ææ–­ï¼Œåé¢çš„é€»è¾‘ï¼ˆåŠ¨ç”»ã€éŸ³æ•ˆã€çŠ¶æ€æ”¹å˜ï¼‰å…¨éƒ½ä¸å†æ‰§è¡Œ |


**æ¡ˆä¾‹å¯¹æ¯”ï¼š**
æˆ‘ä»¬ä¾ç„¶æ˜¯åœ¨`[HarmonyPatch(typeof(Operational), nameof(Operational.SetActive))]`ä¸Šæ‰“è¡¥ä¸ã€‚
```csharp

// æƒ…å†µ Aï¼šç¯¡æ”¹å‚æ•°ï¼ˆåŸé€»è¾‘ç»§ç»­è·‘ï¼Œä½†ç”¨ä½ çš„æ•°ï¼‰
public static void Prefix(ref bool value) 
{
    value = true; // å“ªæ€•ç©å®¶ç‚¹äº†å…³é—­ï¼Œå»ºç­‘ä¹Ÿä¼šå› ä¸ºå‚æ•°è¢«æ”¹è€Œä¿æŒå¼€å¯
}

// æƒ…å†µ Bï¼šå½»åº•æ‹¦æˆªï¼ˆåŸé€»è¾‘ç›´æ¥ç½¢å·¥ï¼‰
public static bool Prefix(bool value, bool force_ignore)
{
    return false;  // åŸæ–¹æ³•ä½“å†…çš„ä»£ç ä¸€è¡Œéƒ½ä¸ä¼šè·‘ï¼ŒåŠŸèƒ½è¢«å®Œå…¨â€œå†»ç»“â€
}

```

---
<h2 id="postfix">ğŸŸ© äº”ã€Postfixï¼ˆæ‰§è¡Œåè¡¥å……ï¼‰</h2>

`Prefix` åœ¨åŸæ–¹æ³•æ‰§è¡Œå®Œæ¯•åè¿è¡Œã€‚å®ƒæ˜¯æœ€æ¨èçš„è¡¥ä¸æ–¹å¼ï¼Œå› ä¸ºå®ƒä¸ä¼šä¸­æ–­æ¸¸æˆçš„æ­£å¸¸é€»è¾‘ï¼Œå…¼å®¹æ€§æœ€å¥½ã€‚

### 5.1 å®æˆ˜ä»£ç ï¼šè¿½åŠ é¢å¤–é€»è¾‘
- ä½œç”¨ï¼š åœ¨åŸé€»è¾‘è·‘å®Œåï¼Œé¡ºä¾¿æ‰§è¡Œä¸€äº›ä½ è‡ªå·±çš„æ“ä½œã€‚

```csharp
[HarmonyPatch(typeof(ElectrolyzerConfig), "CreateBuildingDef")]
public class ElectrolyzerCreateBuildingDef_Patch
{
    public static void Postfix(ref BuildingDef __result)
    {
        // å°†ç”µè§£å™¨çš„åŠŸè€—æ”¹ä¸º 1 ç“¦
        __result.EnergyConsumptionWhenActive = 1f;
        Debug.Log("ç”µè§£å™¨çš„åŠŸè€—å·²è¢«ä¿®æ”¹ä¸º 1 ç“¦");
    }
}
```
- åœºæ™¯ï¼š åˆå§‹åŒ–åçš„å±æ€§ä¿®æ­£ã€æ·»åŠ è‡ªå®šä¹‰çš„ç»„ä»¶ã€è§¦å‘é¢å¤–çš„é€šçŸ¥ã€‚
- ä¼˜åŠ¿ï¼š æ— è®ºä½ çš„ä»£ç å†™å¾—å¥½ä¸å¥½ï¼ŒåŸç‰ˆä»£ç éƒ½å·²ç»å®‰å…¨è·‘å®Œäº†ï¼Œä¸ä¼šå¯¼è‡´æ ¸å¿ƒåŠŸèƒ½ä¸¢å¤±ã€‚

---
### 5.2 ä¿®æ”¹è¿”å›å€¼ï¼šä¿®æ”¹è®¡ç®—ç»“æœ

- ä½œç”¨ï¼š åŠ«æŒåŸæ–¹æ³•çš„è¿”å›å€¼ï¼Œè®©æ¸¸æˆæ‹¿åˆ°ä½ â€œè°ƒåŒ…â€åçš„ç»“æœã€‚
```csharp
[HarmonyPatch(typeof(Overheatable), nameof(Overheatable.OverheatTemperature), MethodType.Getter)]
public static class Overheatable_OverheatTemperature_Patch
{
    // ref __result æŒ‡å‘åŸæ–¹æ³•ç®—å‡ºæ¥çš„é‚£ä¸ªè¿”å›å€¼
    public static void Postfix(ref float __result)
    {
        __result = 9999f; // è®©å»ºç­‘æ°¸è¿œä¸ä¼šå› ä¸ºæ¸©åº¦è¿‡é«˜è€ŒæŸåï¼ˆå¼ºè¡Œæ”¹æ‰åˆ¤å®šæ•°å€¼ï¼‰
    }
}

```

| æšä¸¾é¡¹ | æ€ä¹ˆè®¤å‡ºå®ƒï¼ˆçœ‹ ILSpy/dnSpyï¼‰ | å¹²å˜›çš„ |
| :--- | :--- | :--- |
| **Normal** | æ–¹æ³•ååé¢å¸¦ä¸ªæ‹¬å·ï¼Œæ¯”å¦‚ OnSpawn() | åœ¨æŸä¸ªåŠ¨ä½œæ‰§è¡Œå‰åâ€œæ’ä¸€è„šâ€ |
| **Getter** | ä»£ç é‡Œé•¿è¿™æ ·ï¼šfloat Speed { get; } | ç”¨äºä¿®æ”¹æ¸¸æˆâ€œè¯»å–â€åˆ°çš„æ•°æ® |
| **Setter** | ä»£ç é‡Œé•¿è¿™æ ·ï¼šset { ... } | ç”¨äºåœ¨æ¸¸æˆå°è¯•ä¿®æ”¹æŸä¸ªæ•°å€¼æ—¶è¿›è¡Œæ‹¦æˆª |
| **Constructor** | è·Ÿç±»åé•¿å¾—ä¸€æ¨¡ä¸€æ ·çš„æ–¹æ³• | åœ¨å¯¹è±¡åˆšåˆ›å»ºã€è¿˜æ²¡æ”¾è¿›ä¸–ç•Œæ—¶ï¼Œæå‰ä¿®æ”¹å®ƒçš„é»˜è®¤å­—æ®µæˆ–åˆå§‹åŒ–é€»è¾‘ |
| **StaticConstructor** |å‰é¢å¸¦ static çš„æ„é€ å‡½æ•° | ä¸“é—¨ç”¨æ¥ä¿®æ”¹æ¸¸æˆåŠ è½½æ—¶å°±å®šæ­»çš„å…¨å±€é™æ€å¸¸é‡ |
| **Enumerator** | é‡Œé¢æœ‰ä¸€å † yield return çš„æ–¹æ³• | ä¸“é—¨å¯¹ä»˜ ONI é‡Œçš„å¼‚æ­¥åŠ¨ä½œã€åŠ¨ç”»åºåˆ—æˆ–é‚£äº›ä¸æ˜¯ç¬é—´å®Œæˆçš„ä»»åŠ¡ |

---

### ğŸ› ï¸ æ€»ç»“ï¼šPrefix ä¸ Postfix æ€ä¹ˆé€‰ï¼Ÿ
- é€‰ Prefix çš„å”¯ä¸€ç†ç”±ï¼šä½ éœ€è¦åœ¨äº‹æƒ…å‘ç”Ÿä¹‹å‰æ‹¦ä½å®ƒï¼ˆæ¯”å¦‚é˜»æ­¢ä¸€ä¸ªåŠ¨ä½œï¼Œæˆ–è€…åœ¨åŸé€»è¾‘ä½¿ç”¨å‚æ•°å‰æ”¹æ‰å‚æ•°ï¼‰ã€‚

- å…¶ä»–æƒ…å†µå…¨é€‰ Postfixï¼šåªè¦ä¸éœ€è¦æ‹¦æˆªåŸé€»è¾‘ï¼Œå°±å¾€åŸé€»è¾‘åé¢æ¥ä»£ç ã€‚è¿™æ˜¯ä¿æŒ Mod ç¨³å®šã€ä¸åæ¡£çš„é‡‘æ³•åˆ™ã€‚

---



## ğŸ” å…­ã€çŠ¶æ€æ¡¥æ¥ï¼ˆ__state ä¼ å€¼ï¼‰
æœ‰æ—¶å€™ä½ éœ€è¦åœ¨æ‰§è¡Œä¹‹åçŸ¥é“æ‰§è¡Œä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆï¼ˆæ¯”å¦‚ï¼šå­˜è´§å‰æœ‰å¤šå°‘ï¼Œå­˜è´§åå‰©å¤šå°‘ï¼‰ã€‚`__state` å°±æ˜¯ä¸“é—¨ç”¨æ¥åœ¨ `Prefix` å’Œ `Postfix` ä¹‹é—´å¸¦è´§çš„â€œä¸´æ—¶å‚¨ç‰©æŸœâ€ã€‚


### 6.1 å®æˆ˜ç”¨æ³•ï¼šå‰åçŠ¶æ€å¯¹æ¯”
- ä½œç”¨ï¼š è®°å½•ä¸€ä¸ªåˆå§‹å€¼ï¼Œç­‰åŸé€»è¾‘è·‘å®Œåå†æ‹¿å‡ºæ¥ç®—å·®å€¼ã€‚
```csharp
[HarmonyPatch(typeof(Storage), "Store")]
public static class Storage_Monitor_Patch
{
    // 1. åœ¨æ‰§è¡Œå‰ï¼ŒæŠŠå½“å‰å¸§æ•°å¡è¿› __state å‚¨ç‰©æŸœ
    public static void Prefix(out int __state)
    {
        __state = Time.frameCount;
    }

    // 2. åœ¨æ‰§è¡Œåï¼Œä» __state å‚¨ç‰©æŸœæ‹¿å‡ºåˆšæ‰å­˜çš„å¸§æ•°
    public static void Postfix(int __state)
    {
        int cost = Time.frameCount - __state;
        if (cost > 0) 
        {
            Debug.Log($"è¿™æ¬¡å­˜è´§å±…ç„¶èŠ±äº† {cost} å¸§çš„æ—¶é—´ï¼");
        }
    }
}
```
### ğŸ’¡ ä¸ºä»€ä¹ˆç”¨å®ƒï¼Ÿ

* **æ€§èƒ½è¿½è¸ªï¼š** è®°å½•æ–¹æ³•è¿è¡Œå‰åçš„æ—¶é—´å·®ã€‚
* **é€»è¾‘åˆ¤å®šï¼š** è®°å½•æ‰§è¡Œå‰çš„æ•°å€¼ï¼ˆæ¯”å¦‚ç”Ÿå‘½å€¼ï¼‰ï¼Œæ‰§è¡Œåå‘ç°æ•°å€¼æ²¡å˜ï¼Œå°±è§¦å‘è¡¥æ•‘é€»è¾‘ã€‚
* **ç®€æ´æ€§ï¼š** å®ƒåªåœ¨è¿™ä¸€æ¬¡è¡¥ä¸è°ƒç”¨ä¸­æœ‰æ•ˆï¼Œè·‘å®Œå°±é”€æ¯ï¼Œä¸ä¼šåƒå…¨å±€å˜é‡é‚£æ ·æ±¡æŸ“ä½ çš„ä»£ç ã€‚

### ğŸ”‘ å‚æ•°ç»†èŠ‚è¯´æ˜ï¼ˆé¿å‘ï¼‰

* **Prefix é‡Œï¼š** å¿…é¡»ç”¨ out æˆ–è€… refï¼ˆæ¯”å¦‚ out int __stateï¼‰ï¼Œå¦åˆ™å­˜ä¸è¿›å»ã€‚
* **Postfix é‡Œï¼š** ç›´æ¥ç”¨ï¼ˆæ¯”å¦‚ int __stateï¼‰å³å¯æ‹¿åˆ°ä¹‹å‰å­˜çš„å€¼ã€‚


---

## ğŸ”“ ä¸ƒã€è®¿é—® private å­—æ®µï¼ˆAccessToolsä¸ ___ï¼‰
åœ¨ ONI æºç ä¸­ï¼Œå¾ˆå¤šå˜é‡è¢«å£°æ˜ä¸º `private` ä½ ç›´æ¥ç”¨ `__instance` å˜é‡å æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚è¿™æ—¶æœ‰ä¸¤ç§å¸¸ç”¨çš„â€œç ´é—¨â€æ–¹æ³•ã€‚


### 7.1 æ–¹æ³•ä¸€ï¼šä¸‰ä¸‹åˆ’çº¿æš—å·ï¼ˆæœ€å¿«ã€æœ€æ¨èï¼‰
å¦‚æœåªæ˜¯æƒ³ç®€å•è¯»å†™ä¸€ä¸ªå®ä¾‹å˜é‡ï¼ŒHarmony æä¾›äº†ä¸€ä¸ªæç®€å†™æ³•ï¼šåœ¨å‚æ•°åå‰åŠ  ä¸‰ä¸ªä¸‹åˆ’çº¿ã€‚
```csharp
[HarmonyPatch(typeof(Storage), "OnSpawn")]
public static class Storage_Easy_Patch
{
    // ___capacityKg å¯¹åº” Storage ç±»é‡Œçš„ç§æœ‰å˜é‡ capacityKg
    public static void Postfix(Storage __instance, ref float ___capacityKg)
    {
        ___capacityKg = 9999f; // ç›´æ¥åƒæ”¹æ™®é€šå˜é‡ä¸€æ ·æ”¹æ‰å®ƒ
    }
}
```
### 7.2 æ–¹æ³•äºŒï¼šä½¿ç”¨ AccessToolsï¼ˆæ€§èƒ½æ›´å¥½ã€æ›´å¼ºå¤§ï¼‰
å½“ä½ éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹é¢‘ç¹è®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œæˆ–è€…è¦å¤„ç† `static`ï¼ˆé™æ€ï¼‰ç§æœ‰å˜é‡æ—¶ï¼Œå»ºè®®å…ˆæå‰å®šä¹‰ä¸€ä¸ªâ€œåé—¨â€ã€‚
```csharp
using System.Reflection;

public static class Storage_Hard_Patch
{
    // 1. å…ˆå®šä¹‰åé—¨ï¼ˆåªæ‰¾ä¸€æ¬¡ï¼Œæ€§èƒ½æ›´ä¼˜ï¼‰
    private static readonly FieldInfo CapacityField = 
        AccessTools.Field(typeof(Storage), "capacityKg");

    [HarmonyPatch(typeof(Storage), "OnSpawn")]
    public static class Patch
    {
        public static void Postfix(Storage __instance)
        {
            // 2. æš´åŠ›å†™å…¥æ–°å€¼
            CapacityField.SetValue(__instance, 9999f);
        }
    }
}
```

### ğŸ’¡ æ€ä¹ˆé€‰ï¼Ÿ

* **ä¸‰ä¸‹åˆ’çº¿ (`___`)**ï¼š**æ—¥å¸¸ä¸»åŠ›ã€‚** åªè¦èƒ½è·‘é€šï¼Œå°±ä¼˜å…ˆç”¨å®ƒï¼Œä»£ç çŸ­ä¸”ä¸å®¹æ˜“å†™é”™ã€‚
* **AccessTools**ï¼š**é‡å‹å·¥å…·ã€‚** - ä¸“é—¨å¯¹ä»˜ `static private`ï¼ˆé™æ€ç§æœ‰ï¼‰å˜é‡ã€‚
  - é€‚åˆåœ¨è¡¥ä¸å‡½æ•°ä½“å¤–é¢æ‹¿å–æ•°æ®ã€‚
  - å¦‚æœä½ éœ€è¦æè‡´çš„æ€§èƒ½ä¼˜åŒ–ï¼Œæå‰å®šä¹‰ä¸€ä¸ª `static readonly FieldInfo` ä¼šæ¯”ä¸‰ä¸‹åˆ’çº¿å¿«é‚£ä¹ˆä¸€ç‚¹ç‚¹ã€‚
---

## ğŸ§¬ Transpilerï¼ˆæ”¹åº•å±‚æŒ‡ä»¤ï¼‰
è¿™æ˜¯ Harmony ä¸­æœ€ç¡¬æ ¸çš„è¡¥ä¸ã€‚
- å®ƒä¸æ˜¯åœ¨æ–¹æ³•å‰åæ’è¯ï¼Œè€Œæ˜¯ç›´æ¥å†²è¿›åŸä»£ç å†…éƒ¨ï¼ŒæŠŠæŸå‡ è¡Œä»£ç â€œæŠ æ‰â€æˆ–è€…â€œæ‰åŒ…â€ã€‚

### 8.1 å®ƒçš„ä½œç”¨
å¦‚æœä½ å‘ç° `Prefix` å’Œ `Postfix` éƒ½æ²¡æ³•æ”¹æ‰æŸä¸ªé€»è¾‘ï¼Œé€šå¸¸æ˜¯å› ä¸ºé‚£ä¸ªé€»è¾‘æ˜¯ç¡¬ç¼–ç åœ¨æ–¹æ³•ä¸­é—´çš„ã€‚

* **æ”¹å¸¸é‡ï¼š**  æ¯”å¦‚ä»£ç é‡Œå†™æ­»äº†ä¸€ä¸ª `if (speed > 10f)`ï¼Œä½ æƒ³æŠŠ `10f` æ”¹æˆ `100f`ã€‚
* **åˆ ä»£ç ï¼š** æ¯”å¦‚ä½ æƒ³æŠŠåŸç‰ˆä¸­æŸä¸€è¡Œçƒ¦äººçš„æ£€æµ‹é€»è¾‘å½»åº•æŠ¹é™¤ã€‚
* **åŠ æŒ‡ä»¤ï¼š** åœ¨æ–¹æ³•çš„ç¬¬ 50 è¡Œå’Œç¬¬ 51 è¡Œä¸­é—´å¡è¿›ä½ è‡ªå·±çš„é€»è¾‘ã€‚

### 8.2 å®æˆ˜ä»£ç ï¼šä¿®æ”¹ç¡¬ç¼–ç æ•°å€¼
- åœºæ™¯ï¼š æ¸¸æˆåŸæœ¬è§„å®šæŒ–çŸ¿åªæ‰ä¸€åŠæ‰è½ç‰©`0.5f`ï¼Œæˆ‘ä»¬é€šè¿‡è¡¥ä¸æŠŠå®ƒæ”¹æˆå…¨æ‰ `1.0f`ã€‚
```csharp
[HarmonyPatch(typeof(WorldDamage), "OnDigComplete")]
public static class WorldDamage_OnDigComplete_Patch
{
    // Transpiler æ¥æ”¶çš„æ˜¯ä¸€ç»„ IL æŒ‡ä»¤é›†
    private static IEnumerable<CodeInstruction> Transpiler(IEnumerable<CodeInstruction> instructions)
    {
        foreach (var ins in instructions)
        {
            // ç›®æ ‡ï¼šæ‰¾åˆ°æŒ‡ä»¤æ˜¯â€œåŠ è½½æµ®ç‚¹æ•° 0.5â€çš„é‚£ä¸€è¡Œ
            if (ins.opcode == OpCodes.Ldc_R4 && (float)ins.operand == 0.5f)
            {
                // æ”¹æˆ 1.0f
                ins.operand = 1.0f;
            }
            yield return ins;
        }
    }
}
```
### âš ï¸ ä¸ºä»€ä¹ˆè¯´è¦æ…ç”¨ï¼Ÿ
* **æŠ¥é”™éš¾æ‰¾ï¼š** æ™®é€šçš„è¡¥ä¸å†™é”™ï¼Œé€šå¸¸åªæ˜¯åŠŸèƒ½å¤±æ•ˆï¼›`Transpiler` å†™é”™ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ¸¸æˆç›´æ¥é—ªé€€æˆ–æ•´ä¸ªç±»å´©æ‰ã€‚
* **ææ˜“å†²çªï¼š** å¦‚æœæœ‰ä¸¤ä¸ª Mod åŒæ—¶å¯¹åŒä¸€ä¸ªæ–¹æ³•çš„åŒä¸€è¡Œä»£ç åŠ¨äº†â€œæ‰‹æœ¯â€ï¼Œæ¸¸æˆå¤§æ¦‚ç‡ä¼šå½“åœºæŠ¥åºŸã€‚
* **é—¨æ§›é«˜ï¼š** ä½ éœ€è¦çœ‹æ‡‚ ILï¼ˆä¸­é—´è¯­è¨€ï¼‰ æŒ‡ä»¤ï¼ˆç±»ä¼¼äº `ldarg.0`  `call`  `stfld` ç­‰ï¼‰ï¼Œå°±åƒåœ¨çœ‹å¤©ä¹¦ã€‚

---

## ğŸ§¯ ä¹ã€Finalizerï¼ˆå¼‚å¸¸å…œåº•ï¼‰

```csharp
[HarmonyPatch(typeof(SomeClass), "SomeMethod")]
public static class SomeMethod_Finalizer
{
    public static void Finalizer(Exception __exception)
    {
        if (__exception != null)
        {
            Debug.LogError(__exception);
        }
    }
}
```

---

## âš ï¸ åã€ONI Mod å¸¸è§ç¿»è½¦ç‚¹

- Patch æ–¹æ³•å¿˜è®° `static`
- å‚æ•°ç­¾åä¸åŸæ–¹æ³•ä¸ä¸€è‡´
- Prefix `return false` ä½†æ²¡å¤„ç†è¿”å›å€¼
- Transpiler ä¿®æ”¹é€»è¾‘è¿‡å¤š


---

